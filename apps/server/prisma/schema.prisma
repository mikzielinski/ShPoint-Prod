generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model User {
  id                   String                @id @default(cuid())
  email                String                @unique
  name                 String?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  avatarUrl            String?
  role                 Role                  @default(USER)
  lastLoginAt          DateTime?
  status               UserStatus            @default(ACTIVE)
  image                String?
  passwordHash         String?
  invitedAt            DateTime?
  invitedBy            String?
  username             String?               @unique
  suspendedAt          DateTime?
  suspendedBy          String?
  suspendedReason      String?
  suspendedUntil       DateTime?
  invitationsSent      Int                   @default(0)
  invitationsLimit     Int                   @default(0)
  lastInvitationSentAt DateTime?
  cards                Card[]
  characterCollections CharacterCollection[]
  collections          Collection[]
  missionCollections   MissionCollection[]
  setCollections       SetCollection[]
  strikeTeams          StrikeTeam[]

  @@index([createdAt])
  @@index([email])
  @@index([username])
  @@index([role])
  @@index([status])
  @@index([suspendedUntil])
  @@index([suspendedBy])
  @@index([invitedBy])
  @@index([invitationsSent])
  @@index([invitationsLimit])
}

model Card {
  id          String     @id @default(cuid())
  title       String
  slug        String     @unique
  body        Json?
  status      CardStatus @default(DRAFT)
  createdById String
  publishedAt DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  createdBy   User       @relation(fields: [createdById], references: [id])

  @@index([slug])
  @@index([status, publishedAt])
  @@index([createdAt])
}

model AllowedEmail {
  id        String    @id @default(cuid())
  email     String    @unique
  role      Role      @default(USER)
  invitedBy String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  isActive  Boolean   @default(true)
  expiresAt DateTime?
  usedAt    DateTime?

  @@index([email])
  @@index([role])
  @@index([isActive])
  @@index([invitedBy])
  @@index([usedAt])
  @@index([expiresAt])
}

model Collection {
  id        String           @id @default(cuid())
  userId    String
  title     String?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     CollectionItem[]

  @@index([userId])
  @@index([createdAt])
}

model CollectionItem {
  id           String     @id @default(cuid())
  collectionId String
  cardId       String
  status       ItemStatus @default(OWNED)
  notes        String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)

  @@unique([collectionId, cardId])
  @@index([collectionId])
  @@index([cardId])
  @@index([status])
}

model CharacterCollection {
  id          String   @id @default(cuid())
  userId      String
  characterId String
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  isFavorite  Boolean  @default(false)
  isOwned     Boolean  @default(false)
  isPainted   Boolean  @default(false)
  isSold      Boolean  @default(false)
  isWishlist  Boolean  @default(false)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, characterId])
  @@index([userId])
  @@index([characterId])
  @@index([isOwned])
  @@index([isPainted])
  @@index([isWishlist])
}

model SetCollection {
  id         String   @id @default(cuid())
  userId     String
  setId      String
  notes      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  isFavorite Boolean  @default(false)
  isOwned    Boolean  @default(false)
  isPainted  Boolean  @default(false)
  isSold     Boolean  @default(false)
  isWishlist Boolean  @default(false)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, setId])
  @@index([userId])
  @@index([setId])
  @@index([isOwned])
  @@index([isPainted])
  @@index([isWishlist])
}

model MissionCollection {
  id          String    @id @default(cuid())
  userId      String
  missionId   String
  notes       String?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  isCompleted Boolean   @default(false)
  isFavorite  Boolean   @default(false)
  isLocked    Boolean   @default(false)
  isOwned     Boolean   @default(false)
  isWishlist  Boolean   @default(false)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, missionId])
  @@index([userId])
  @@index([missionId])
  @@index([isOwned])
  @@index([isCompleted])
  @@index([isWishlist])
}

model StrikeTeam {
  id          String                @id @default(cuid())
  userId      String
  name        String
  type        StrikeTeamType        @default(MY_TEAMS)
  description String?
  createdAt   DateTime              @default(now())
  updatedAt   DateTime              @updatedAt
  user        User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  characters  StrikeTeamCharacter[]

  @@index([userId])
  @@index([type])
}

model StrikeTeamCharacter {
  id           String        @id @default(cuid())
  strikeTeamId String
  characterId  String
  role         CharacterRole
  order        Int
  createdAt    DateTime      @default(now())
  strikeTeam   StrikeTeam    @relation(fields: [strikeTeamId], references: [id], onDelete: Cascade)

  @@unique([strikeTeamId, characterId])
  @@index([strikeTeamId])
  @@index([characterId])
}

enum Role {
  USER
  ADMIN
  EDITOR
  GUEST
}

enum UserStatus {
  ACTIVE
  SUSPENDED
}

enum CardStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum ItemStatus {
  OWNED
  PAINTED
  WISHLIST
}

enum CollectionStatus {
  OWNED
  PAINTED
  WISHLIST
  SOLD
  FAVORITE
}

enum StrikeTeamType {
  MY_TEAMS
  DREAM_TEAMS
}

enum CharacterRole {
  PRIMARY
  SECONDARY
  SUPPORT
}
